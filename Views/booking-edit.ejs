<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>แก้ไขการจอง</title>
    <link rel="icon" href="../image/Mae-Fah-Luang-University-2.png" type="image/x-icon">
    <link rel="stylesheet" href="/Css/manage.css">
    <link rel="stylesheet"
        href="https://cdn-uicons.flaticon.com/2.1.0/uicons-regular-rounded/css/uicons-regular-rounded.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<style>
    @media (max-width: 768px) {
        .breadcrumb-nav {
            display: none !important;
        }

        .breadcrumb-nav,
        .user-display {
            display: none !important;
        }


    }

    .colored-toast.swal2-icon-success {
        background-color: #a5dc86 !important;
    }

    @media (max-width: 768px) {
        .breadcrumb-nav {
            display: none !important;
        }
    }

    .card .sample {
        background: #ffd600;
    }

    .card .sample:hover {
        background-color: none !important;
    }

    .card .manual {
        background: #14a2b8;
    }

    .card .manual:hover {
        background-color: none !important;
    }
</style>

<body>
    <%- include('components/navbar.ejs') -%>
        <div class="container-fluid mt-3" id="main">
            <div class="row">
                <div class="col-12">
                    <div class="container-fluid p-0 m-0"
                        style="display: flex;justify-content: space-between;align-items: center;">
                        <button type="button" onclick="toggleNav()" class="toggler mb-2 p-0 m-0"
                            style="font-size: 20px">
                            <i class="fi fi-rr-indent" id="toggleIcon" style="color: white"></i>
                        </button>
                        <% if (user.role==='admin' ) { %>
                            <nav class="breadcrumb-nav" style="--bs-breadcrumb-divider: '>'; margin-left: 3%;"
                                aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a
                                            href="<%= user.role !=='user'?'/dashboard':'/manage' %>">หน้าหลัก</a>
                                    </li>
                                    <li class="breadcrumb-item"><a href="/manage">จัดการการจอง</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">แก้ไขการจอง</li>
                                </ol>
                            </nav>
                            <% }else{ %>

                                <nav class="breadcrumb-nav" style="--bs-breadcrumb-divider: '>'; margin-left: 3%;"
                                    aria-label="breadcrumb">
                                    <ol class="breadcrumb">
                                        <li class="breadcrumb-item active" aria-current="page"><a
                                                href="/manage">หน้าหลัก</a></li>
                                        <li class="breadcrumb-item ">แก้ไขการจอง</li>
                                    </ol>
                                </nav>
                                <% } %>
                                    <%- include('components/userinfo.ejs') -%>
                    </div>
                    <%- include('components/progress-bar.ejs') -%>
                        <% if (booking.status>=1) {%>
                            <%- include('components/booking_card.ejs') -%>
                                <% } %>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <% if (booking.status>=2&& booking.status !==5) { %>
                        <!-- ผู้จัดรถอนุมัติ -->
                        <div class="row">
                            <div class="card mt-3 mb-3 " style="box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.25);">
                                <div id="admin-approve-body" class="card-body">
                                    <form action="/events/<%= booking._id %>" method="POST">
                                        <input id="statusCancel" type="hidden" name="status">
                                        <input id="cancelerName" type="hidden" name="cancelerName">
                                        <input id="adminApproveName" type="hidden" name="adminApproveName">
                                        <input type="hidden" id="adminApprove_Time" name="adminApprove_Time">
                                        <input type="hidden" id="adminApprove" name="adminApprove">
                                        <h5 class="form-label ">ผู้จัดรถอนุมัติการจอง</h5>
                                        <hr>
                                        <div class="row text-center">
                                            <% if (booking.adminApprove===null) { %>
                                                <p>โปรดตรวจสอบ <strong>พนักงานขับรถ</strong> และ
                                                    <strong>ยานพาหนะ</strong> ณ วันที่ใช้รถว่ามีความพร้อมหรือไม่
                                                </p>
                                                <% }else{ %>
                                                    <div class="col-md-6 text-start">
                                                        <label class="form-label mt-2">ผู้จัดรถ</label>
                                                        <input type="text" class="form-control" disabled
                                                            value="<%= booking.adminApprove?booking.adminApproveName:booking.cancelerName%>">
                                                    </div>
                                                    <div class="col-md-6 text-start">
                                                        <label class="form-label mt-2">
                                                            <%=booking.adminApprove?'เวลาอนุมัติ':'เวลาไม่อนุมัติ' %>
                                                        </label>
                                                        <input type="text" class="form-control" disabled
                                                            value="<%=booking.adminApprove? new Date(booking.adminApprove_Time).toLocaleString('th-TH'):new Date(booking.UnApprove_Time).toLocaleString('th-TH') %>">
                                                    </div>

                                                    <% if(!booking.adminApprove){ %>
                                                        <div class="text-start">
                                                            <label class="form-label  mt-2">
                                                                หมายเหตุ
                                                            </label>
                                                            <input type="text" class="form-control" disabled
                                                                value="<%= booking.note%>">
                                                        </div>
                                                        <% } %>
                                                            <% } %>
                                        </div>
                                        <hr>
                                        <div class="row text-center">
                                            <% if (user.role==='admin' &&booking.status!==4) { %>
                                                <div>
                                                    <input type="text" class="form-control mt-4 mb-4" id="adminInput"
                                                        style="display: none;"
                                                        placeholder="โปรดระบุหมายเหตุการไม่อนุมัติ" required
                                                        name="note">
                                                    <% if (booking.status !==3) { %>
                                                        <a role="button" href="/manage" class="btn btn-primary">กลับ</a>
                                                        <% } %>
                                                            <% if (booking.adminApprove===null) { %>
                                                                <button type="submit" class="btn btn-primary btn-lg"
                                                                    id="adminUnapproveBtn"
                                                                    style="background-color: red;">ไม่อนุมัติ</button>
                                                                <button type="submit" class="btn btn-primary btn-lg"
                                                                    id="adminApproveBtn"
                                                                    style="background-color: rgb(44, 169, 44);"
                                                                    onclick="displayAlertApproveAdmin()">อนุมัติ</button>
                                                                <% } else if (booking.adminApprove) { %>
                                                                    <button type="submit" class="btn btn-primary btn-lg"
                                                                        id="adminUnapproveBtn"
                                                                        style="background-color: red;">ไม่อนุมัติ</button>
                                                                    <% } else { %>
                                                                        <button type="submit"
                                                                            class="btn btn-primary btn-lg"
                                                                            id="adminApproveBtn"
                                                                            style="background-color: rgb(44, 169, 44);"
                                                                            onclick="displayAlertApproveAdmin()">อนุมัติ</button>
                                                                        <% } %>
                                                </div>
                                                <% } else { %>
                                                    <% if (booking.adminApprove) { %>
                                                        <p style="font-size: 22px;"
                                                            class="text-center mt-3 text-success">
                                                            ผู้จัดรถอนุมัติการจองสำเร็จ,รอการจัดรถ</p>
                                                        <% } else if(booking.adminApprove===null){ %>
                                                            <p style="font-size: 20px;"
                                                                class="text-center mt-3 text-danger">
                                                                รอผู้จัดรถอนุมัติการจอง
                                                            </p>
                                                            <% }else{ %>
                                                                <p style="font-size: 20px;"
                                                                    class="text-center mt-3 text-danger">
                                                                    ผู้จัดรถไม่อนุมัติการจอง
                                                                </p>
                                                                <% } %>
                                                                    <% } %>
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </div>
                        <!-- เลือกคนขับ รถที่ใช้ -->
                        <% if (booking.adminApprove) { %>
                            <div class="row">
                                <div class="card mt-3 mb-3 " style="box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.25);">
                                    <div id="manage-vehicle_driver-body" class="card-body">
                                        <form action="/events/<%= booking._id %>" method="POST">
                                            <h5 class="form-label ">ผู้จัดรถ</h5>
                                            <hr>
                                            <input id="status2" type="hidden" name="status">
                                            <input id="adminName" type="hidden" name="adminName">
                                            <input type="hidden" id="carArrange_Time" name="carArrange_Time">
                                            <div class="row">
                                                <div class="col-md">
                                                    <label class="form-label mt-2">พนักงานขับรถ</label>
                                                    <select <%=booking.status !==4&& user.role==='admin'
                                                        ?'':'disabled'%>
                                                        name="driver_id"
                                                        class="form-select" required>
                                                        <% const driver=drivers.find(d=>d.id===booking.driver_id)%>
                                                            <% if (driver) { %>
                                                                <option value="<%=booking.driver_id? driver._id:''%>"
                                                                    disabled selected>
                                                                    <%= booking.driver_id?driver.firstname +
                                                                        driver.lastname:''%>
                                                                </option>
                                                                <% }else{ %>
                                                                    <option value="" disabled selected>
                                                                        ไม่พบข้อมูล, โปรดเลือกพนักงานขับรถ
                                                                    </option>
                                                                    <% } %>
                                                                        <% drivers.forEach(driver=> { %>
                                                                            <option value="<%= driver._id %>">
                                                                                <%= driver.firstname %>
                                                                                    <%= driver.lastname %>
                                                                            </option>
                                                                            <% }); %>
                                                    </select>
                                                </div>
                                                <div class="col-md">
                                                    <label class="form-label mt-2">ยานพาหนะ</label>
                                                    <select <%=booking.status!==4&& user.role==="admin" ? ''
                                                        : 'disabled' %>
                                                        name="vehicle_id"
                                                        class="form-select" required>
                                                        <% const vehicle=vehicles.find(v=>v.id===booking.vehicle_id)%>
                                                            <% if (vehicle) { %>
                                                                <option value="<%=booking.vehicle_id? vehicle._id:''%>"
                                                                    disabled selected>
                                                                    <%= vehicle.register%>
                                                                </option>
                                                                <% }else{ %>
                                                                    <% if (booking.vehicle) { %>
                                                                        <option value="" disabled selected>
                                                                            <% if(booking.status>=4){%>
                                                                                <%= booking.vehicle %>
                                                                                    <% }else{ %>
                                                                                        รถไม่พร้อมใช้งาน <%=
                                                                                            user.role!=='admin'
                                                                                            ?'รอการจัดรถ':'กรุณาจัดรถใหม่'
                                                                                            %>
                                                                                            <% } %>
                                                                        </option>
                                                                        <% }else{%>
                                                                            <option value="" disabled selected>
                                                                                ไม่พบข้อมูล, โปรดเลือกยานพาหนะ
                                                                            </option>
                                                                            <% } %>
                                                                                <% } %>
                                                                                    <% vehicles.forEach(vehicle=>{%>
                                                                                        <option
                                                                                            value="<%= vehicle._id %>">
                                                                                            <%= vehicle.register%>
                                                                                        </option>
                                                                                        <% }); %>
                                                    </select>
                                                </div>
                                            </div>
                                            <hr>
                                            <% if (booking.status===2 && user.role==='admin' ) { %>
                                                <div class="text-center mt-3">
                                                    <a role="button" href="/manage" class="btn btn-primary">กลับ</a>
                                                    <button type="submit" class="btn btn-primary btn-lg"
                                                        id="save_manageBtn"
                                                        style="background-color: rgb(44, 169, 44);">บันทึก</button>
                                                </div>
                                                <% } else if(booking.status===2&&user.role!=='admin' ){%>
                                                    <p style="font-size: 20px;" class="text-center mt-3 text-danger">
                                                        รอการจัดรถ,ไม่พร้อมใช้งาน
                                                    </p>
                                                    <% } else if (booking.status===3 && user.role !=='admin' ){%>
                                                        <% if (driver&&vehicle) { %>
                                                            <p style="font-size: 20px;"
                                                                class="text-center mt-3 text-success">
                                                                จัดรถสำเร็จ,พร้อมใช้งาน
                                                            </p>
                                                            <% }else{ %>
                                                                <p style="font-size: 20px;"
                                                                    class="text-center mt-3 text-danger">
                                                                    รอการจัดรถ,ไม่พร้อมใช้งาน
                                                                </p>
                                                                <% } %>
                                                                    <% }else if( user.role==='admin' && booking.status
                                                                        !==4 ){ %>
                                                                        <div class="text-center mt-3">
                                                                            <button type="submit"
                                                                                class="btn btn-primary btn-lg"
                                                                                id="save_manageBtn"
                                                                                style="background-color: rgb(44, 169, 44);">แก้ไขการบันทึก</button>
                                                                        </div>
                                                                        <% }else{ %>
                                                                            <p style="font-size: 20px;"
                                                                                class="text-center mt-3 text-success">
                                                                                จัดรถสำเร็จ,พร้อมใช้งาน</p>
                                                                            <% } %>


                                        </form>
                                    </div>
                                </div>
                            </div>

                            <% if(booking.status>=3 ) {%>
                                <div class="row">
                                    <div class="card mt-3 mb-3"
                                        style="box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.25);">
                                        <div id="record-body" class="card-body">
                                            <form action="/events/<%= booking._id %>" method="POST">
                                                <h5 class="form-label">ผู้บันทึกเลขไมล์</h5>
                                                <hr>
                                                <input id="statusRecord" type="hidden" name="status">
                                                <input type="hidden" id="completion_Time" name="completion_Time">
                                                <div class="row">
                                                    <div class="col-md">
                                                        <label class="form-label mt-4">เลขไมล์ก่อนเดินทาง</label>
                                                        <input type="number" min="0" step="0.01" class="form-control"
                                                            name="kilometer_start" id="km_start" placeholder="km"
                                                            required <%=user.role !=='admin' ? 'disabled' : '' %>
                                                        value="<%= booking.kilometer_start %>">
                                                    </div>
                                                    <div class="col-md">
                                                        <label class="form-label mt-4">เลขไมล์หลังเดินทาง</label>
                                                        <input type="number" min="0" step="0.01" class="form-control"
                                                            name="kilometer_end" id="km_end" placeholder="km" required
                                                            <%=user.role !=='admin' ? 'disabled' : '' %>
                                                        value="<%= booking.kilometer_end %>">
                                                    </div>

                                                    <div class="col-md">
                                                        <label class="form-label mt-4">ระยะทางทั้งหมด</label>
                                                        <input type="number" class="form-control" name="total_kilometer"
                                                            id="total_km" value="<%= booking.total_kilometer %>"
                                                            readonly required <%=user.role !=='admin' ? 'disabled' : ''
                                                            %>>
                                                    </div>
                                                    <p id="displayText" style="color: red;"></p>
                                                </div>
                                                <% if (booking.status===4) { %>
                                                    <div class="text-center mt-3">
                                                        <a role="button" href=" /manage"
                                                            class=" btn btn btn-primary align-self-start">กลับ</a>
                                                        <a role="button" href=" /print/<%=booking._id %>"
                                                            class=" btn btn btn-secondary "><i
                                                                class="fa-solid fa-print text-white"></i>
                                                            พิมพ์เอกสาร</a>
                                                        <% if(user.role==='admin' ) {%>
                                                            <button type="submit" class="btn btn-primary btn-lg"
                                                                id="save_recordBtn"
                                                                style="background-color: rgb(44, 169, 44);">แก้ไขการบันทึก</button>
                                                            <% } %>
                                                    </div>
                                                    <% } else if (booking.status !==4 && user.role !=='admin' ) { %>
                                                        <p style="font-size: 20px;"
                                                            class="text-center mt-3 text-danger">
                                                            รอการบันทึกเลขไมล์</p>
                                                        <% } else { %>
                                                            <div class="text-center mt-3">
                                                                <a role="button" href="/manage"
                                                                    class="btn btn-primary">กลับ</a>
                                                                <button type="submit" class="btn btn-primary btn-lg"
                                                                    id="save_recordBtn"
                                                                    style="background-color: rgb(44, 169, 44);">บันทึก</button>
                                                            </div>
                                                            <% } %>

                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <% } %>
                                    <% } %>
                                        <% } %>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                function calculateTotalKilometer() {
                    let kmStart = parseFloat(document.getElementById('km_start').value);
                    let kmEnd = parseFloat(document.getElementById('km_end').value);
                    const totalKm = kmEnd - kmStart;

                    if (kmEnd < kmStart || totalKm === 0 || isNaN(totalKm) || isNaN(kmStart) || isNaN(kmEnd)) {
                        document.getElementById('displayText').innerHTML = "กรอกข้อมูลไม่ถูกต้อง";
                        document.getElementById('total_km').value = '';
                        document.getElementById('save_recordBtn').disabled = true; // Disable submit button
                    } else {
                        document.getElementById('total_km').value = totalKm.toFixed(2);
                        document.getElementById('displayText').innerHTML = ""; // Clear error message
                        document.getElementById('save_recordBtn').disabled = false; // Enable submit button
                    }
                }

                function validateKmStartInput(event) {
                    const inputField = event.target;
                    const value = inputField.value;

                    // Prevent the value from starting with 0
                    if (inputField.value.startsWith('0')) {
                        inputField.value = '';
                    }
                }

                document.getElementById('km_start').addEventListener('input', function (event) {
                    validateKmStartInput(event);
                    calculateTotalKilometer();
                });

                document.getElementById('km_end').addEventListener('input', function (event) {
                    const inputField = event.target;
                    const value = inputField.value;


                    calculateTotalKilometer();
                });
            });

        </script>

        <script>
            document
                .querySelector('#record-body form')
                .addEventListener('submit', function (event) {
                    event.preventDefault();
                    if (event.submitter && event.submitter.id === 'save_recordBtn') {
                        displayAlertRecord();
                    }
                });
        </script>
        <script>
            document.querySelector("#booking-body form").addEventListener("submit", function (event) {
                event.preventDefault();
                if (event.submitter && event.submitter.id === 'approveBtn') {
                    displayAlertApprove()
                } else if (event.submitter && event.submitter.id === 'unapproveBtn') {
                    displayAlertUnapprove()
                } else if (event.submitter && event.submitter.id === 'saveupdateBtn') {
                    displayAlertSaveupdate()
                }
            });
            document.querySelector("#manage-vehicle_driver-body form").addEventListener("submit", function (event) {
                event.preventDefault();

                if (event.submitter && event.submitter.id === 'save_manageBtn') {
                    displayAlertSavemanage()
                }
            });
        </script>
        <script>
            document.querySelector("#admin-approve-body form").addEventListener("submit", function (event) {
                event.preventDefault();

                if (event.submitter && event.submitter.id === 'adminApproveBtn') {
                    displayAlertApproveAdmin()
                } else if (event.submitter && event.submitter.id === 'adminUnapproveBtn') {
                    displayAlertUnapproveAdmin()
                }
            });
            async function displayAlertApproveAdmin() {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    iconColor: 'white',
                    customClass: {
                        popup: 'colored-toast',
                    },
                    showConfirmButton: false,
                    timer: 1000,
                    timerProgressBar: true,
                });
                const swalWithBootstrapButtons = Swal.mixin({
                    customClass: {
                        confirmButton: 'btn btn-success',
                        cancelButton: 'btn btn-danger',
                    },
                    buttonsStyling: false,
                });
                const result = await swalWithBootstrapButtons.fire({
                    title: 'คุณแน่ใจหรือไม่?',
                    text: 'คุณต้องการยืนยันที่จะอนุมัติ!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'ยืนยัน',
                    cancelButtonText: 'ยกเลิก',
                    reverseButtons: true,
                });

                if (result.isConfirmed) {
                    await Toast.fire({
                        icon: 'success',
                        title: 'ทำการอนุมัติสำเร็จ',
                    });
                    const time = new Date();
                    document.getElementById('adminApprove_Time').value = time.toISOString();
                    document.getElementById('statusCancel').value = 2;
                    document.getElementById('adminApprove').value = true;
                    document.getElementById('adminApproveName').value = '<%= user.firstname %> <%= user.lastname %>';
                    await document.querySelector('#admin-approve-body form').submit();
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    swalWithBootstrapButtons.fire({
                        title: 'ยกเลิก',
                        text: 'คุณได้ทำการยกเลิก',
                        icon: 'error',
                    });
                }
            }




        </script>
        <script>
            document.getElementById('adminUnapproveBtn').addEventListener('click', function () {
                let inputField = document.getElementById('adminInput');
                if (inputField.style.display === "none") {
                    inputField.style.display = "block";
                } else {
                    inputField.style.display = "none";
                }
            });
            async function displayAlertUnapproveAdmin() {
                const swalWithBootstrapButtons = Swal.mixin({
                    customClass: {
                        confirmButton: 'btn btn-success',
                        cancelButton: 'btn btn-danger',
                    },
                    buttonsStyling: false,
                });
                const result = await swalWithBootstrapButtons.fire({
                    title: 'คุณแน่ใจหรือไม่?',
                    text: 'คุณต้องการยืนยันที่จะไม่อนุมัติ!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'ยืนยัน',
                    cancelButtonText: 'ยกเลิก',
                    reverseButtons: true,
                });

                if (result.isConfirmed) {
                    console.log("Test")
                    document.getElementById('adminApprove').value = false;
                    document.getElementById('statusCancel').value = 2;
                    document.getElementById('cancelerName').value = '<%= user.firstname %> <%= user.lastname %>'
                    await document.querySelector('#admin-approve-body form').submit();
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    swalWithBootstrapButtons.fire({
                        title: 'ยกเลิก',
                        text: 'คุณได้ทำการยกเลิก',
                        icon: 'error',
                    });
                }
            }
        </script>
        <script>
            const bookingStatus = '<%= bookingStatus %>';
            updateProgress(bookingStatus - 1);
            function updateProgress(currentStep) {

                const stepperItems = document.querySelectorAll('.stepper-item');

                stepperItems.forEach(item => {
                    item.classList.remove('active');
                });

                for (let i = 0; i <= currentStep; i++) {
                    stepperItems[i].classList.add('active');
                }


            }
        </script>
        <script>
            async function displayAlertRecord() {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    iconColor: 'white',
                    customClass: {
                        popup: 'colored-toast',
                    },
                    showConfirmButton: false,
                    timer: 1500,
                    timerProgressBar: true,
                });
                const swalWithBootstrapButtons = Swal.mixin({
                    customClass: {
                        confirmButton: 'btn btn-success',
                        cancelButton: 'btn btn-danger',
                    },
                    buttonsStyling: false,
                });
                const result = await swalWithBootstrapButtons.fire({
                    title: 'คุณแน่ใจหรือไม่?',
                    text: 'คุณต้องการยืนยันที่จะส่ง!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'ยืนยัน',
                    cancelButtonText: 'ยกเลิก',
                    reverseButtons: true,
                });

                if (result.isConfirmed) {
                    const time = new Date();
                    await Toast.fire({
                        icon: 'success',
                        title: 'บันทึกข้อมูลสำเร็จ',
                    });
                    document.getElementById('completion_Time').value = new Date().toISOString();
                    document.getElementById('statusRecord').value = 4;
                    await document.querySelector('#record-body form').submit();
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    swalWithBootstrapButtons.fire({
                        title: 'ยกเลิก',
                        text: 'คุณได้ทำการยกเลิก',
                        icon: 'error',
                    });
                }
            }
            // Display Aleart Save manage
            async function displayAlertSavemanage() {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    iconColor: 'white',
                    customClass: {
                        popup: 'colored-toast',
                    },
                    showConfirmButton: false,
                    timer: 1500,
                    timerProgressBar: true,
                });
                const swalWithBootstrapButtons = Swal.mixin({
                    customClass: {
                        confirmButton: 'btn btn-success',
                        cancelButton: 'btn btn-danger',
                    },
                    buttonsStyling: false,
                });
                const result = await swalWithBootstrapButtons.fire({
                    title: 'คุณแน่ใจหรือไม่?',
                    text: 'คุณต้องการยืนยันที่จะบันทึก!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'ยืนยัน',
                    cancelButtonText: 'ยกเลิก',
                    reverseButtons: true,
                });

                if (result.isConfirmed) {
                    await Toast.fire({
                        icon: 'success',
                        title: 'บันทึกข้อมูลสำเร็จ',
                    });
                    document.getElementById('status2').value = 3;
                    document.getElementById('carArrange_Time').value = new Date().toISOString();
                    document.getElementById('adminName').value = '<%= user.firstname%> <%= user.lastname%>';
                    await document.querySelector('#manage-vehicle_driver-body form').submit();
                    console.log('successfully')
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    swalWithBootstrapButtons.fire({
                        title: 'ยกเลิก',
                        text: 'คุณได้ทำการยกเลิก',
                        icon: 'error',
                    });
                }
            }

        </script>
        <script src="../JS/navbar.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>