<!DOCTYPE html>
<html>

<head>
    <title>PDF Form</title>
    <link rel="icon" href="../image/Mae-Fah-Luang-University-2.png" type="image/x-icon">
    <link rel='stylesheet'
        href='https://cdn-uicons.flaticon.com/2.1.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

        * {
            font-family: 'Kanit', sans-serif;
        }

        .container {
            margin-top: 50px;
            /* padding: 50px; */
        }

        p,
        li {
            font-size: 20px;
        }

        nav ol li {
            font-size: 16px;
        }

        #org_img {
            width: 150px;
        }

        @media print {
            body {
                font-size: 12px;
            }

            .container {
                margin-top: 0;
                padding: 10px;
            }

            .print-button,
            .navbar {
                display: none;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-md">
            <a class="navbar-brand ms-auto" id="generate-pdf" style="cursor: pointer;"><i class="fa-solid fa-print"></i>
                พิมพ์</a>
        </div>
    </nav>
    <nav class="breadcrumb-nav" style="--bs-breadcrumb-divider: '>'; margin-left: 3%;" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="<%= user.role !=='user'?'/dashboard':'/manage' %>">หน้าหลัก</a></li>
            <% if (user.role !=='user' ) { %>
                <li class="breadcrumb-item"><a href="/manage">จัดการการจอง</a></li>
                <% } %>
                    <li class="breadcrumb-item"><a href="/booking-edit/<%= booking.id %>">แก้ไขการจอง</a></li>
                    <li class="breadcrumb-item active" aria-current="page">แบบฟอร์ม</li>
        </ol>
    </nav>
    <div class="container" id="content">
        <!-- ส่วนบน -->
        <div class="section header">
            <div class="row">
                <div class="col-md-6 text-center">
                    <img src="../image/Mae-Fah-Luang-University-2.png" id="org_img" alt="Organization Logo">
                </div>
                <div class="col-md-6">
                    <p>แบบฟอร์มการขอใช้รถยนต์</p>
                    <p>ศูนย์การแพทย์มหาวิทยาลัยแม่ฟ้าหลวง โทร 053-914-023</p>
                    <p>Email: medical-center@mfu.ac.th</p>
                    <p><strong>รหัสการจอง:</strong>
                        <%= booking.bookingID %>
                    </p>
                    <p><strong>วันที่จองรถ:</strong>
                        <%= bookingDate %>
                    </p>
                </div>
                <hr>
            </div>
        </div>
        <!-- ส่วนกลาง -->
        <div class="section middle">

            <div class="row">
                <div class="row">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-auto">
                                        <p><strong>ผู้ร้องขอ:</strong>

                                        </p>
                                    </div>
                                    <div class="col-auto">
                                        <p style="white-space: nowrap;">
                                            <%= booking.userinfo %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-auto">
                                        <p><strong>เบอร์โทร:</strong>

                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p>
                                            <%= mobile_number_user %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <p><strong>ข้อมูลเพิ่มเติม:</strong></p>
                            <div class="col-auto">
                                <p>หน่วยงาน:</p>
                            </div>
                            <div class="col-auto">
                                <p>
                                    <%= org_user %>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-auto">
                                        <p><strong>ผู้อนุมัติของส่วนงาน:</strong>
                                        </p>
                                    </div>
                                    <div class="col-auto">
                                        <p style="white-space: nowrap;">
                                            <%= booking.approverName ? booking.approverName : '-' %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-auto">
                                        <p><strong>เบอร์โทร:</strong>

                                        </p>
                                    </div>
                                    <div class="col-auto">
                                        <p>
                                            <%= mobile_number_approver %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <p><strong>ข้อมูลเพิ่มเติม:</strong></p>
                            <div class="col-auto">
                                <p>เวลาอนุมัติ:</p>
                                <p>หน่วยงาน:</p>
                            </div>
                            <div class="col-auto">
                                <p>
                                    <%= approvalTime ? approvalTime : '-' %>
                                </p>
                                <p>
                                    <%= org_user %>
                                </p>
                            </div>
                        </div>
                    </div>

                </div>
                <hr>
                <div class="row">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-auto">
                                        <p><strong>ผู้จัดรถ/ผู้อนุมัติรถ:</strong>

                                        </p>
                                    </div>
                                    <div class="col-auto">
                                        <p style="white-space: nowrap;">
                                            <%= booking.adminName ? booking.adminName : '-' %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-auto">
                                        <p><strong>เบอร์โทร:</strong>

                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p>
                                            <%= mobile_number_admin %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <p><strong>ข้อมูลเพิ่มเติม:</strong></p>
                            <div class="col-auto">
                                <p>
                                    เวลาจัดรถ:
                                </p>
                                <p>หน่วยงาน:</p>
                            </div>
                            <div class="col-auto">
                                <p>
                                    <%= carArrangeTime? carArrangeTime: '-' %>
                                </p>
                                <p>
                                    <%= org_Admin? org_Admin: '-' %>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-auto">
                                        <p><strong>พนักงานขับรถ:</strong>
                                        </p>
                                    </div>
                                    <div class="col-auto">
                                        <p style="white-space: nowrap;">
                                            <%= booking.driver? booking.driver : '-' %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-auto">
                                        <p><strong>เบอร์โทร:</strong>

                                        </p>
                                    </div>
                                    <div class="col-auto">
                                        <p>
                                            <%= mobile_number_driver %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <p><strong>ข้อมูลเพิ่มเติม:</strong></p>
                            <div class="col-auto">
                                <p>หน่วยงาน:</p>
                            </div>
                            <div class="col-auto">
                                <p>
                                    <%= org_driver? org_driver: '-' %>
                                </p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <hr>
        </div>
        <!-- ส่วนล่าง -->
        <div class="section footer">
            <div class="row">
                <div class="row ">
                    <div class="col-md-6">
                        <p><strong>จำนวนผู้เดินทาง:</strong></p>

                    </div>
                    <div class="col-md-6">
                        <p>

                            <%= booking.passengerCount %> คน
                        </p>
                    </div>
                </div>
                <hr>
                <div class="row ">
                    <div class="col-md-6">
                        <p><strong>เวลารับ-เวลากลับ:</strong></p>
                    </div>
                    <div class="col-md-6">
                        <p>
                            <%= startDate %> - <%= endDate %>
                        </p>
                    </div>
                </div>
                <hr>
                <div class="row ">
                    <div class="col-md-6">
                        <p><strong>สถานที่รับ-สถานที่กลับ:</strong></p>
                    </div>
                    <div class="col-md-6">
                        <p>
                            <%= booking.placestart %> - <%= booking.placeend %>
                        </p>
                    </div>
                </div>
                <hr>
                <div class="row ">
                    <div class="col-md-6">
                        <p><strong>ยานพานะที่ใช้:</strong></p>
                    </div>
                    <div class="col-md-6">
                        <p>
                            <% if (vehicle) { %>
                                <%= vehicle.register%>
                                    <% }else{%>
                                        <%= booking.vehicle?booking.vehicle:'-' %>
                                            <% } %>
                        </p>
                    </div>
                </div>
                <hr>
                <div class="row ">
                    <div class="col-md-6">
                        <p><strong>รายละเอียดการเบิกจ่ายค่าตอบแทนล่วงเวลา:</strong></p>
                    </div>
                    <div class="col-md-6">
                        <p>
                            <%= booking.compensation_payment ? booking.compensation_payment : '-' %>
                        </p>
                    </div>
                </div>
                <hr>
                <div class="row ">
                    <div class="col-md-6">
                        <p><strong>ขอใช้รถเพื่อปฏิบัติภารกิจ:</strong></p>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <p><strong>หัวข้อ:</strong>
                                <%= booking.title %>
                            </p>
                        </div>
                        <div class="row">
                            <p><strong>รายละเอียด:</strong> ประกอบด้วย</p>
                            <div>

                                <ol>
                                    <% booking.passengers.forEach(passenger=> { %>
                                        <li>
                                            <%= passenger %>
                                        </li>
                                        <% }); %>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mileage-section">
            <hr>
            <div class="row text-center">
                <div class="col-md-4">
                    <div class="row">
                        <p><strong>เลขไมล์ก่อนเดินทาง</strong></p>
                    </div>
                    <div class="row">
                        <p>
                            <%= booking.kilometer_start ? booking.kilometer_start : '-' %>
                        </p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="row">
                        <p><strong>เลขไมล์หลังเดินทาง</strong></p>
                    </div>
                    <div class="row">
                        <p>
                            <%= booking.kilometer_end ? booking.kilometer_end: '-' %>
                        </p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="row">
                        <p><strong>ระยะทางทั้งหมด</strong></p>
                    </div>
                    <div class="row">
                        <p>
                            <%= booking.total_kilometer? booking.total_kilometer: '-' %> กิโลเมตร
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        document.getElementById('generate-pdf').addEventListener('click', async function () {
            var { jsPDF } = window.jspdf;
            var content = document.getElementById('content');
            var pdf = new jsPDF('p', 'mm', 'a4');
            var pageHeight = pdf.internal.pageSize.height;
            var marginTop = 10;
            var currentHeight = marginTop;

            async function addSectionToPDF(contentElement) {
                return html2canvas(contentElement).then(canvas => {
                    var imgData = canvas.toDataURL('image/png');
                    var imgWidth = 190;
                    var imgHeight = canvas.height * imgWidth / canvas.width;

                    if (currentHeight + imgHeight > pageHeight) {
                        pdf.addPage();
                        currentHeight = marginTop;
                    }
                    pdf.addImage(imgData, 'PNG', 10, currentHeight, imgWidth, imgHeight);
                    currentHeight += imgHeight + 5;
                });
            }

            var headerSection = content.querySelector('.header');
            var middleSection = content.querySelector('.middle');
            var footerSection = content.querySelector('.footer');
            var mileageSection = content.querySelector('.mileage-section');

            await addSectionToPDF(headerSection);
            await addSectionToPDF(middleSection);
            await addSectionToPDF(footerSection);
            await addSectionToPDF(mileageSection);

            var pdfBlob = pdf.output('blob');
            var pdfUrl = URL.createObjectURL(pdfBlob);
            window.open(pdfUrl);
        });
    </script>
</body>

</html>